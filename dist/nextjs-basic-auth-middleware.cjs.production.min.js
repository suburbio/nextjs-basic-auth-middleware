"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("basic-auth")),s=e(require("tsscmp")),t=require("url"),n=function(e,r){if(void 0===r.url)return console.log("request url is undefined"),!1;var s=t.parse(r.url).pathname;return e.some((function(e){return null==s?void 0:s.startsWith(e)}))};exports.default=function(e,t,o){var i,a,u,c=o.realm,l=void 0===c?"protected":c,d=o.users,v=void 0===d?[]:d,p=o.includePaths,h=void 0===p?["/"]:p,f=o.excludePaths,A=void 0===f?[]:f;try{var m=process.env.BASIC_AUTH_CREDENTIALS||"";if(0===m.length&&0===v.length)return Promise.resolve();var _=process.env.BASIC_AUTH_PATHS?process.env.BASIC_AUTH_PATHS.split(";"):h,P=process.env.BASIC_AUTH_EXCLUDE_PATHS?process.env.BASIC_AUTH_EXCLUDE_PATHS.split(";"):A;if(n(P,e)||!n(_,e))return Promise.resolve();var E=m.length>0?(u=[],m.split("|").forEach((function(e){if(e.length<3)throw new Error("Received incorrect basic auth syntax, use <username>:<password>, received "+e);var r=e.split(":");if(0===r[0].length||0===r[1].length)throw new Error("Received incorrect basic auth syntax, use <username>:<password>, received "+e);u.push({name:r[0],password:r[1]})})),u):v,H=r(e);return H&&(i=H,a=!1,E.forEach((function(e){s(e.name,i.name)&&s(e.password,i.pass)&&(a=!0)})),a)||(t.statusCode=401,t.setHeader("WWW-Authenticate",'Basic realm="'+l+'"'),t.end("401 Access Denied")),Promise.resolve()}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=nextjs-basic-auth-middleware.cjs.production.min.js.map
